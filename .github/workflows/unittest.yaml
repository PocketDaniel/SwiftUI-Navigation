name: Run unit tests

on: pull_request_target

jobs:
  unit_tests:
    runs-on: macos-13
    name: Run unit tests
    steps:
      - uses: actions/checkout@v4
      - name: Test
        run: | 
          xcodebuild test -scheme Test -resultBundlePath TestResults -destination 'platform=iOS Simulator,name=iPhone 14' 

      - uses: kishikawakatsumi/xcresulttool@v1
        with:
          path: TestResults.xcresult
        if: success() || failure()

  check_for_release:
    if: github.event.pull_request.merged # && startsWith(github.event.pull_request.title, "Release")
    runs-on: ubuntu-latest
    name: Check for release
    steps:
      - run: echo "The PR was merged"
